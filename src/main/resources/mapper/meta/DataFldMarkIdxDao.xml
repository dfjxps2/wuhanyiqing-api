<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.dfjinxin.modules.meta.dao.DataFldMarkIdxDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.dfjinxin.modules.meta.entity.DataFldMarkIdxEntity" id="dataFldMarkIdxMap">
        <result property="fldid" column="Fldid"/>
        <result property="labelid" column="Labelid"/>
        <result property="markIdxType" column="Mark_Idx_Type"/>
    </resultMap>

    <insert id="batchAddFldLabel" parameterType="java.util.List">
        insert into data_fld_mark_idx (Fldid,Labelid,Mark_Idx_Type)
        values
        <foreach collection="labelList" item="item" index="index" separator=",">
            (
            #{fldId},#{item},'1'
            )
        </foreach>
    </insert>

    <delete id="batchDelFldLabel" parameterType="java.util.List">
        delete from data_fld_mark_idx where Fldid = #{fldId}
        and Labelid in
        <foreach item="labelId" collection="labelList" open="(" separator="," close=")">
            #{labelId}
        </foreach>
    </delete>

    <!--查询标签被未删除表字段标引次数 add by zhc 7.22-->
    <select id="selectLabelUsedTimesByFld" resultType="java.lang.Integer">
        select count(*) from data_fld_mark_idx dfmi
        left join data_fld df on dfmi.Fldid = df.Fldid
        left join data_tbl dt on dt.Data_Tblid = df.Data_Tblid
        where dfmi.Labelid =#{labelId}
        and dt.Del_Dt is null
    </select>

    <!--查询标签被未删除表字段标引次数 add by zhc 7.23-->
    <select id="selectLabelUsedTimesByLabelIds" resultType="java.lang.Integer">
        select count(*) from data_fld_mark_idx dfmi
        left join data_fld df on dfmi.Fldid = df.Fldid
        left join data_tbl dt on dt.Data_Tblid = df.Data_Tblid
        where dt.Del_Dt is null
        and dfmi.Labelid in
        <foreach item="labelId" collection="labelIds" open="(" separator="," close=")">
            #{labelId}
        </foreach>
    </select>

</mapper>