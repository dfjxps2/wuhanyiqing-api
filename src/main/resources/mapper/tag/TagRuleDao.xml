<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.dfjinxin.modules.tag.dao.TagRuleDao">

    <resultMap type="io.dfjinxin.modules.tag.entity.TagRuleEntity" id="ruleMap">
        <result property="ruleid" column="Ruleid"/>
        <result property="ruleDesc" column="Rule_Desc"/>
        <result property="labelid" column="Labelid"/>
        <result property="markIdxObjType" column="Mark_Idx_Obj_Type"/>
        <result property="objMatchStgy" column="Obj_Match_Stgy"/>
        <result property="ruleExprs" column="Rule_Exprs"/>
        <result property="tnmtid" column="Tnmtid"/>
    </resultMap>

    <!--列表展示-->
    <select id="queryTagRuleList" resultType="io.dfjinxin.modules.tag.entity.TagRuleEntity">
		select Ruleid,Rule_Desc,label.Labelid,Mark_Idx_Obj_Type,Obj_Match_Stgy,Rule_Exprs from AUTO_MARK_IDX_RULE rule
		left join
        LABEL label on rule.Labelid = label.Labelid
        <include refid="tagRuleWhere"></include>
        limit #{start},#{pageSize}
	</select>

    <!--分页-->
    <select id="queryCountTagRule" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(*) from AUTO_MARK_IDX_RULE rule
       left join
        LABEL label on rule.Labelid = label.Labelid
        <include refid="tagRuleWhere"></include>
    </select>

    <!-- 条件查询 -->
    <sql id="tagRuleWhere">
        <where>
            <if test="labelid!=null and labelid!=''">
                label.Labelid = #{labelid}
            </if>
               and  rule.tnmtid = #{tnmtid}
        </where>

    </sql>


    <!--规则添加-->
    <insert id="saveTagRule" parameterType="io.dfjinxin.modules.tag.entity.TagRuleEntity">
        INSERT INTO auto_mark_idx_rule ( rule_desc, labelid, mark_idx_obj_type, obj_match_stgy, rule_exprs, tnmtid )
        VALUES (#{ruleDesc},#{labelid},#{markIdxObjType},#{objMatchStgy},#{ruleExprs},#{tnmtid})
    </insert>


    <!--判断添加规则名称是否重复-->
    <select id="selectTagRuleDescList" resultMap="ruleMap" parameterType="io.dfjinxin.modules.tag.entity.TagRuleEntity">
        select Rule_Desc,Labelid,Ruleid from AUTO_MARK_IDX_RULE where Rule_Desc = #{ruleDesc} and Labelid = #{labelid} limit 1
    </select>
</mapper>